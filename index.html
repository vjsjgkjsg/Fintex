
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>üí≥ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ö–æ–Ω—Ç—Ä–æ–ª—å</title>

<meta name="theme-color" content="#020617">

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<link rel="icon" href="icons/icon-192.png">

<!-- CSS -->
<link rel="stylesheet" href="css/main.css">
<link rel="stylesheet" href="css/themes.css">
<link rel="stylesheet" href="css/animations.css">
</head>

<body class="dark">

<!-- ================= PIN ================= -->
<div class="modal show" id="pinModal">
  <div class="top">
    <b>–í–≤–µ–¥–∏—Ç–µ PIN</b>
  </div>
  <div class="content">
    <input id="pinInput" type="password" placeholder="PIN">
    <button onclick="Auth.login()">–í–æ–π—Ç–∏</button>
  </div>
</div>

<!-- ================= HEADER ================= -->
<header>
  <h1>üí≥ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ö–æ–Ω—Ç—Ä–æ–ª—å</h1>
  <div id="balance">–ë–∞–ª–∞–Ω—Å: 0 ‚Ç∏</div>
  <button class="ghost" onclick="UI.toggleTheme()">–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É</button>
</header>

<!-- ================= CATEGORY SLIDER ================= -->
<div id="categories"></div>

<!-- ================= RECORD MODAL ================= -->
<div class="modal" id="recordModal">
  <div class="top">
    <b id="modalTitle"></b>
    <span class="close" onclick="UI.close()">‚úï</span>
  </div>

  <div class="content">

    <select id="monthSelect"></select>

    <input id="amount" type="number" placeholder="–°—É–º–º–∞">
    <input id="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">

    <div class="quick">
      <button onclick="Records.quick(1000)">+1000</button>
      <button onclick="Records.quick(5000)">+5000</button>
    </div>

    <button onclick="Records.add()">–î–æ–±–∞–≤–∏—Ç—å</button>

    <input placeholder="–ü–æ–∏—Å–∫" oninput="Filters.search(this.value)">

    <select onchange="Filters.sort(this.value)">
      <option value="new">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
      <option value="old">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
    </select>

    <ul id="records"></ul>

    <button class="danger" onclick="Export.backup()">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>

  </div>
</div>

<!-- ================= JS ================= -->
<script>
/* =================================================
   STORAGE
================================================= */
const Storage = {
  data: JSON.parse(localStorage.getItem("finance_test")) || {
    pin: "1234",
    theme: "dark",
    categories: [
      { id: 1, name: "–î–æ—Ö–æ–¥", type: "income", color: "#22c55e" },
      { id: 2, name: "–†–∞—Å—Ö–æ–¥", type: "spent", color: "#ef4444" },
      { id: 3, name: "–î–æ–ª–≥", type: "debt", color: "#eab308" }
    ],
    records: []
  },
  save() {
    localStorage.setItem("finance_test", JSON.stringify(this.data));
  }
};

/* =================================================
   AUTH
================================================= */
const Auth = {
  login() {
    if (pinInput.value === Storage.data.pin) {
      pinModal.classList.remove("show");
    } else {
      alert("–ù–µ–≤–µ—Ä–Ω—ã–π PIN");
    }
  }
};

/* =================================================
   UI
================================================= */
const UI = {
  currentCat: null,

  open(cat) {
    this.currentCat = cat;
    modalTitle.innerText = cat.name;
    recordModal.classList.add("show");
    Records.render();
  },

  close() {
    recordModal.classList.remove("show");
  },

  toggleTheme() {
    document.body.classList.toggle("light");
    document.body.classList.toggle("dark");
  }
};

/* =================================================
   CATEGORIES
================================================= */
function renderCategories() {
  categories.innerHTML = "";

  Storage.data.categories.forEach(cat => {
    const el = document.createElement("div");
    el.className = "cat";
    el.style.background = cat.color;
    el.innerHTML = `
      <b>${cat.name}</b>
      <small>${cat.type}</small>
    `;
    el.onclick = () => UI.open(cat);
    categories.appendChild(el);
  });
}

/* =================================================
   RECORDS
================================================= */
const Records = {
  add() {
    if (!amount.value) return;

    Storage.data.records.push({
      id: Date.now(),
      cat: UI.currentCat.id,
      sum: +amount.value,
      text: comment.value,
      date: new Date().toISOString()
    });

    amount.value = "";
    comment.value = "";

    Storage.save();
    this.render();
    Balance.update();
  },

  quick(v) {
    amount.value = (+amount.value || 0) + v;
  },

  render() {
    records.innerHTML = "";

    let list = Storage.data.records.filter(
      r => r.cat === UI.currentCat.id
    );

    list.forEach(r => {
      const li = document.createElement("li");
      li.innerHTML = `
        <span>${r.sum} ‚Ç∏ ‚Äî ${r.text}</span>
        <span class="trash" onclick="Records.del(${r.id})">üóë</span>
      `;
      records.appendChild(li);
    });

    records.scrollTop = records.scrollHeight;
  },

  del(id) {
    if (!confirm("–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?")) return;
    Storage.data.records = Storage.data.records.filter(r => r.id !== id);
    Storage.save();
    this.render();
    Balance.update();
  }
};

/* =================================================
   FILTERS
================================================= */
const Filters = {
  sort(type) {
    Storage.data.records.sort((a, b) =>
      type === "new" ? b.id - a.id : a.id - b.id
    );
    Records.render();
  },

  search(text) {
    document.querySelectorAll("#records li").forEach(li => {
      li.style.display = li.innerText.toLowerCase().includes(text.toLowerCase())
        ? ""
        : "none";
    });
  }
};

/* =================================================
   BALANCE
================================================= */
const Balance = {
  update() {
    let inc = 0, spent = 0, debt = 0;

    Storage.data.records.forEach(r => {
      const type = Storage.data.categories.find(c => c.id === r.cat).type;
      if (type === "income") inc += r.sum;
      if (type === "spent") spent += r.sum;
      if (type === "debt") debt += r.sum;
    });

    balance.innerText = `–ë–∞–ª–∞–Ω—Å: ${inc - spent - debt} ‚Ç∏`;
  }
};

/* =================================================
   EXPORT
================================================= */
const Export = {
  backup() {
    const blob = new Blob(
      [JSON.stringify(Storage.data, null, 2)],
      { type: "application/json" }
    );
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "finance-backup.json";
    a.click();
  }
};

/* =================================================
   INIT
================================================= */
renderCategories();
Balance.update();
</script>

</body>
</html>
