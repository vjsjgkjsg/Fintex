<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeoBank - Личный Финансовый Трекер</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        /* Скроллбар */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c7c7c7; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }

        /* Анимации */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal { transition: opacity 0.25s ease; }
        body.modal-active { overflow-x: hidden; overflow-y: hidden !important; }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5', // Indigo 600
                        secondary: '#10B981', // Emerald 500
                        danger: '#EF4444', // Red 500
                        dark: '#1F2937'
                    }
                }
            }
        }
    </script>
</head>
<body class="text-gray-800 h-screen flex overflow-hidden">

    <aside class="w-64 bg-white shadow-xl hidden md:flex flex-col z-10">
        <div class="h-20 flex items-center justify-center border-b border-gray-100">
            <i class="fa-solid fa-wallet text-3xl text-primary mr-2"></i>
            <h1 class="text-2xl font-bold text-dark">NeoBank</h1>
        </div>
        <nav class="flex-1 p-4 space-y-2">
            <a href="#" class="flex items-center p-3 text-gray-700 bg-indigo-50 rounded-xl transition hover:bg-indigo-100 font-semibold text-primary">
                <i class="fa-solid fa-chart-pie w-6"></i> Обзор
            </a>
            <a href="#" onclick="alert('Функция в разработке')" class="flex items-center p-3 text-gray-500 hover:bg-gray-50 rounded-xl transition">
                <i class="fa-solid fa-bullseye w-6"></i> Цели
            </a>
            <a href="#" onclick="alert('Функция в разработке')" class="flex items-center p-3 text-gray-500 hover:bg-gray-50 rounded-xl transition">
                <i class="fa-solid fa-gear w-6"></i> Настройки
            </a>
        </nav>
        <div class="p-4 border-t border-gray-100">
            <button onclick="resetData()" class="w-full py-2 px-4 text-sm text-red-500 hover:bg-red-50 rounded-lg transition">
                <i class="fa-solid fa-trash mr-2"></i> Сбросить данные
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-screen overflow-hidden relative">
        <header class="h-16 bg-white shadow-sm flex md:hidden items-center justify-between px-4 z-20">
            <div class="flex items-center">
                <i class="fa-solid fa-wallet text-xl text-primary mr-2"></i>
                <span class="font-bold text-lg">NeoBank</span>
            </div>
            <button class="text-gray-500"><i class="fa-solid fa-bars text-xl"></i></button>
        </header>

        <div class="flex-1 overflow-y-auto p-4 md:p-8">
            <div class="max-w-7xl mx-auto space-y-8">
                
                <div class="flex justify-between items-end">
                    <div>
                        <p class="text-gray-500 text-sm" id="currentDate">Сегодня</p>
                        <h2 class="text-3xl font-bold text-dark">Мои Финансы</h2>
                    </div>
                    <button onclick="toggleModal('transactionModal')" class="bg-primary hover:bg-indigo-700 text-white px-6 py-3 rounded-xl shadow-lg shadow-indigo-200 transition transform hover:-translate-y-1 flex items-center">
                        <i class="fa-solid fa-plus mr-2"></i> Операция
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl p-6 text-white shadow-xl relative overflow-hidden">
                        <div class="absolute right-0 top-0 opacity-10 transform translate-x-4 -translate-y-4">
                            <i class="fa-solid fa-wallet text-9xl"></i>
                        </div>
                        <p class="text-indigo-100 text-sm font-medium mb-1">Текущий баланс</p>
                        <h3 class="text-4xl font-bold mb-4" id="totalBalance">0 ₽</h3>
                        <div class="flex space-x-2 text-xs bg-white/20 w-fit px-2 py-1 rounded-lg backdrop-blur-sm">
                            <span><i class="fa-solid fa-arrow-trend-up"></i> Активный</span>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 flex flex-col justify-center gap-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600">
                                    <i class="fa-solid fa-arrow-down"></i>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-xs uppercase font-bold tracking-wider">Доходы</p>
                                    <p class="text-xl font-bold text-gray-800" id="incomeDisplay">0 ₽</p>
                                </div>
                            </div>
                        </div>
                        <div class="h-px bg-gray-100 w-full"></div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-600">
                                    <i class="fa-solid fa-arrow-up"></i>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-xs uppercase font-bold tracking-wider">Расходы</p>
                                    <p class="text-xl font-bold text-gray-800" id="expenseDisplay">0 ₽</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 relative">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-gray-500 text-xs uppercase font-bold tracking-wider">Мои Долги</p>
                                <h3 class="text-2xl font-bold text-gray-800 mt-1" id="debtDisplay">0 ₽</h3>
                            </div>
                            <button onclick="toggleModal('debtModal')" class="text-primary text-sm hover:underline">
                                + Добавить
                            </button>
                        </div>
                        <ul id="debtsPreviewList" class="space-y-3 text-sm text-gray-600 overflow-y-auto max-h-24">
                            <li class="text-center text-gray-400 italic text-xs mt-4">Долгов нет, вы свободны!</li>
                        </ul>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    
                    <div class="lg:col-span-2 space-y-4">
                        <h3 class="text-xl font-bold text-gray-800">История операций</h3>
                        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                            <div id="transactionList" class="divide-y divide-gray-100">
                                <div class="p-8 text-center text-gray-400">
                                    <i class="fa-solid fa-receipt text-4xl mb-3 opacity-30"></i>
                                    <p>Операций пока нет</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <h3 class="text-xl font-bold text-gray-800">Структура расходов</h3>
                        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 flex flex-col items-center justify-center" style="min-height: 350px;">
                            <canvas id="expenseChart"></canvas>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <div id="transactionModal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50" onclick="toggleModal('transactionModal')"></div>
        
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded-2xl shadow-2xl z-50 overflow-y-auto transform scale-95 transition-transform duration-300">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold text-gray-800">Новая запись</p>
                    <div class="modal-close cursor-pointer z-50" onclick="toggleModal('transactionModal')">
                        <i class="fa-solid fa-xmark text-2xl text-gray-500"></i>
                    </div>
                </div>

                <form id="transactionForm" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4 p-1 bg-gray-100 rounded-xl">
                        <label class="cursor-pointer text-center">
                            <input type="radio" name="type" value="income" class="peer sr-only">
                            <div class="py-2 rounded-lg text-gray-500 peer-checked:bg-white peer-checked:text-green-600 peer-checked:shadow-sm transition font-medium">
                                Доход
                            </div>
                        </label>
                        <label class="cursor-pointer text-center">
                            <input type="radio" name="type" value="expense" class="peer sr-only" checked>
                            <div class="py-2 rounded-lg text-gray-500 peer-checked:bg-white peer-checked:text-red-600 peer-checked:shadow-sm transition font-medium">
                                Расход
                            </div>
                        </label>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Название / Описание</label>
                        <input type="text" id="t-title" placeholder="Например: Продукты" class="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 focus:border-primary focus:bg-white focus:outline-none transition" required>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Сумма (₽)</label>
                        <input type="number" id="t-amount" placeholder="0" class="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 focus:border-primary focus:bg-white focus:outline-none transition" required>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Категория</label>
                        <div class="grid grid-cols-5 gap-2" id="categoryGrid">
                            </div>
                        <input type="hidden" id="t-icon" value="fa-bag-shopping">
                        <input type="hidden" id="t-color" value="bg-blue-100 text-blue-600">
                    </div>

                    <div class="pt-4">
                        <button type="submit" class="w-full bg-primary text-white font-bold py-3 px-4 rounded-xl shadow hover:bg-indigo-700 transition">
                            Сохранить
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="debtModal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-50">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50" onclick="toggleModal('debtModal')"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded-2xl shadow-2xl z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <p class="text-2xl font-bold text-gray-800">Добавить долг</p>
                    <div class="cursor-pointer z-50" onclick="toggleModal('debtModal')">
                        <i class="fa-solid fa-xmark text-2xl text-gray-500"></i>
                    </div>
                </div>
                <form id="debtForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Кому/Кто (Описание)</label>
                        <input type="text" id="d-title" placeholder="Ипотека или Друг Иван" class="w-full px-4 py-3 rounded-xl bg-gray-50 border-gray-200 focus:border-primary focus:outline-none" required>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Сумма долга (₽)</label>
                        <input type="number" id="d-amount" placeholder="0" class="w-full px-4 py-3 rounded-xl bg-gray-50 border-gray-200 focus:border-primary focus:outline-none" required>
                    </div>
                    <div class="pt-2">
                        <button type="submit" class="w-full bg-red-500 text-white font-bold py-3 px-4 rounded-xl shadow hover:bg-red-600 transition">
                            Добавить в долги
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // --- СОСТОЯНИЕ (STATE) ---
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let debts = JSON.parse(localStorage.getItem('debts')) || [];
        let chartInstance = null;

        // --- КАТЕГОРИИ И ИКОНКИ ---
        const categories = [
            { icon: 'fa-bag-shopping', color: 'bg-blue-100 text-blue-600', name: 'Покупки' },
            { icon: 'fa-utensils', color: 'bg-orange-100 text-orange-600', name: 'Еда' },
            { icon: 'fa-car', color: 'bg-zinc-100 text-zinc-600', name: 'Транспорт' },
            { icon: 'fa-house', color: 'bg-purple-100 text-purple-600', name: 'Жилье' },
            { icon: 'fa-heart-pulse', color: 'bg-red-100 text-red-600', name: 'Здоровье' },
            { icon: 'fa-gamepad', color: 'bg-indigo-100 text-indigo-600', name: 'Развлечения' },
            { icon: 'fa-graduation-cap', color: 'bg-yellow-100 text-yellow-600', name: 'Обучение' },
            { icon: 'fa-briefcase', color: 'bg-green-100 text-green-600', name: 'Зарплата' },
            { icon: 'fa-money-bill-transfer', color: 'bg-teal-100 text-teal-600', name: 'Перевод' },
            { icon: 'fa-asterisk', color: 'bg-gray-100 text-gray-600', name: 'Другое' },
        ];

        // --- ИНИЦИАЛИЗАЦИЯ ---
        document.addEventListener('DOMContentLoaded', () => {
            renderDate();
            renderCategories();
            updateUI();
        });

        // --- ОСНОВНЫЕ ФУНКЦИИ ОБНОВЛЕНИЯ ИНТЕРФЕЙСА ---
        function updateUI() {
            // 1. Подсчет сумм
            const amounts = transactions.map(t => t.type === 'income' ? t.amount : -t.amount);
            const total = amounts.reduce((acc, item) => acc + item, 0);
            
            const income = transactions
                .filter(t => t.type === 'income')
                .reduce((acc, t) => acc + t.amount, 0);

            const expense = transactions
                .filter(t => t.type === 'expense')
                .reduce((acc, t) => acc + t.amount, 0);

            const totalDebt = debts.reduce((acc, d) => acc + d.amount, 0);

            // 2. Обновление текста в DOM
            document.getElementById('totalBalance').innerText = formatMoney(total);
            document.getElementById('incomeDisplay').innerText = `+ ${formatMoney(income)}`;
            document.getElementById('expenseDisplay').innerText = `- ${formatMoney(expense)}`;
            document.getElementById('debtDisplay').innerText = formatMoney(totalDebt);

            // 3. Рендер списков
            renderTransactionList();
            renderDebtsList();
            renderChart(income, expense);
            
            // 4. Сохранение
            saveData();
        }

        function formatMoney(amount) {
            return amount.toLocaleString('ru-RU') + ' ₽';
        }

        function renderDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').innerText = new Date().toLocaleDateString('ru-RU', options);
        }

        // --- СПИСОК ТРАНЗАКЦИЙ ---
        function renderTransactionList() {
            const list = document.getElementById('transactionList');
            list.innerHTML = '';

            if (transactions.length === 0) {
                list.innerHTML = `
                    <div class="p-8 text-center text-gray-400">
                        <i class="fa-solid fa-receipt text-4xl mb-3 opacity-30"></i>
                        <p>Операций пока нет. Добавьте первую!</p>
                    </div>`;
                return;
            }

            // Сортировка: новые сверху
            const sorted = [...transactions].reverse();

            sorted.forEach(t => {
                const sign = t.type === 'income' ? '+' : '-';
                const colorClass = t.type === 'income' ? 'text-green-600' : 'text-red-600';
                
                const item = document.createElement('div');
                item.className = 'p-4 flex items-center justify-between hover:bg-gray-50 transition fade-in';
                item.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-full ${t.iconColor} flex items-center justify-center text-lg">
                            <i class="fa-solid ${t.icon}"></i>
                        </div>
                        <div>
                            <p class="font-bold text-gray-800">${t.title}</p>
                            <p class="text-xs text-gray-400">${new Date(t.date).toLocaleDateString()}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="font-bold ${colorClass}">${sign} ${formatMoney(t.amount)}</span>
                        <button onclick="deleteTransaction(${t.id})" class="text-gray-300 hover:text-red-500 transition">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // --- СПИСОК ДОЛГОВ ---
        function renderDebtsList() {
     
