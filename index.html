<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NeoBank Pro | KZ</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè¶</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* –°—Ç–∏–ª–∏ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }

        /* –£—Ç–∏–ª–∏—Ç—ã */
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        .dark .glass { background: rgba(15, 23, 42, 0.9); }
        
        .hide { display: none !important; }
        .show { display: flex !important; }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
    </style>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#4f46e5', // Indigo 600
                        secondary: '#10b981', // Emerald 500
                        danger: '#ef4444', // Red 500
                        darkBg: '#0f172a',
                        darkCard: '#1e293b'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 dark:bg-darkBg text-gray-900 dark:text-gray-100 h-screen flex flex-col overflow-hidden transition-colors duration-300">

    <div id="pinScreen" class="fixed inset-0 z-50 bg-white dark:bg-darkBg flex flex-col items-center justify-center transition-all duration-500">
        <div class="text-center mb-8 fade-in">
            <div class="w-20 h-20 bg-primary rounded-3xl mx-auto flex items-center justify-center text-white text-4xl shadow-xl shadow-indigo-500/30 mb-6">
                <i class="fa-solid fa-shield-halved"></i>
            </div>
            <h1 class="text-3xl font-extrabold mb-2 tracking-tight" id="pinTitle">NeoBank KZ</h1>
            <p class="text-gray-400 text-sm font-medium" id="pinSubtitle">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞</p>
        </div>

        <div class="flex gap-4 mb-10" id="pinDots">
            <div class="dot w-4 h-4 rounded-full bg-gray-200 dark:bg-gray-700 transition-all"></div>
            <div class="dot w-4 h-4 rounded-full bg-gray-200 dark:bg-gray-700 transition-all"></div>
            <div class="dot w-4 h-4 rounded-full bg-gray-200 dark:bg-gray-700 transition-all"></div>
            <div class="dot w-4 h-4 rounded-full bg-gray-200 dark:bg-gray-700 transition-all"></div>
        </div>

        <div class="grid grid-cols-3 gap-6 w-72">
            <button class="pin-btn" onclick="inputPin(1)">1</button>
            <button class="pin-btn" onclick="inputPin(2)">2</button>
            <button class="pin-btn" onclick="inputPin(3)">3</button>
            <button class="pin-btn" onclick="inputPin(4)">4</button>
            <button class="pin-btn" onclick="inputPin(5)">5</button>
            <button class="pin-btn" onclick="inputPin(6)">6</button>
            <button class="pin-btn" onclick="inputPin(7)">7</button>
            <button class="pin-btn" onclick="inputPin(8)">8</button>
            <button class="pin-btn" onclick="inputPin(9)">9</button>
            <div class="pin-btn opacity-0 cursor-default"></div>
            <button class="pin-btn" onclick="inputPin(0)">0</button>
            <button class="pin-btn text-red-500 bg-transparent hover:bg-red-50 dark:hover:bg-red-900/20" onclick="inputPin('del')">
                <i class="fa-solid fa-delete-left"></i>
            </button>
        </div>
        
        <div class="mt-8">
             <button onclick="resetAllData()" class="text-xs text-gray-400 hover:text-red-500 underline">–°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö</button>
        </div>
    </div>

    <style>
        .pin-btn {
            width: 70px; height: 70px; border-radius: 24px;
            font-size: 24px; font-weight: 700;
            background: #f3f4f6; color: #374151;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.1s; cursor: pointer;
        }
        .dark .pin-btn { background: #1e293b; color: #e2e8f0; }
        .pin-btn:active { transform: scale(0.95); background: #4f46e5; color: white; }
    </style>

    <div id="mainApp" class="flex h-full w-full hide opacity-0 transition-opacity duration-700">
        
        <aside class="w-72 bg-white dark:bg-darkCard border-r border-gray-200 dark:border-gray-800 hidden md:flex flex-col z-20">
            <div class="h-24 flex items-center px-8">
                <div class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center text-white mr-3 shadow-lg">
                    <i class="fa-solid fa-wallet"></i>
                </div>
                <h1 class="text-xl font-bold">NeoBank <span class="text-primary">Pro</span></h1>
            </div>
            <nav class="flex-1 px-4 space-y-2 py-4">
                <a href="#" class="flex items-center p-4 bg-indigo-50 dark:bg-indigo-900/20 text-primary rounded-2xl font-bold transition">
                    <i class="fa-solid fa-chart-pie w-8 text-lg"></i> –û–±–∑–æ—Ä
                </a>
            </nav>
            <div class="p-6 border-t border-gray-200 dark:border-gray-800">
                <button onclick="toggleTheme()" class="w-full py-4 px-4 bg-gray-50 dark:bg-gray-800 rounded-2xl text-sm font-bold flex justify-between items-center hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                    <span id="themeLabel">–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</span>
                    <i id="themeIcon" class="fa-solid fa-moon"></i>
                </button>
                <button onclick="location.reload()" class="w-full mt-3 py-4 text-red-500 font-bold text-sm hover:bg-red-50 dark:hover:bg-red-900/10 rounded-2xl transition">
                    –í—ã—Ö–æ–¥
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col h-full relative overflow-hidden">
            <header class="h-16 bg-white dark:bg-darkCard flex md:hidden items-center justify-between px-4 shrink-0 shadow-sm z-30">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center text-white text-xs">
                        <i class="fa-solid fa-wallet"></i>
                    </div>
                    <span class="font-bold text-lg">NeoBank</span>
                </div>
                <button onclick="toggleTheme()" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center">
                    <i class="fa-solid fa-moon"></i>
                </button>
            </header>

            <div class="flex-1 overflow-y-auto p-4 md:p-8 pb-32">
                <div class="max-w-6xl mx-auto space-y-8">
                    
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4 fade-in">
                        <div>
                            <p class="text-gray-500 dark:text-gray-400 font-medium">–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–≤–æ–¥–∫–∞</p>
                            <h2 class="text-3xl md:text-4xl font-black tracking-tight mt-1" id="totalBalance">0 ‚Ç∏</h2>
                        </div>
                        <button onclick="openModal('transactionModal')" class="bg-primary hover:bg-indigo-700 text-white px-6 py-4 rounded-2xl font-bold shadow-lg shadow-indigo-500/30 transition transform hover:-translate-y-1 active:scale-95 w-full md:w-auto flex items-center justify-center gap-2">
                            <i class="fa-solid fa-plus"></i> –ó–∞–ø–∏—Å—å
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 fade-in">
                        <div class="bg-white dark:bg-darkCard p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-800">
                            <h3 class="text-gray-500 dark:text-gray-400 text-xs font-bold uppercase tracking-wider mb-6">–î–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫</h3>
                            <div class="space-y-6">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center"><i class="fa-solid fa-arrow-down"></i></div>
                                        <div><p class="text-xs text-gray-400 font-bold">–î–æ—Ö–æ–¥—ã</p><p class="font-bold text-lg" id="incomeDisplay">0 ‚Ç∏</p></div>
                                    </div>
                                </div>
                                <div class="w-full h-px bg-gray-100 dark:bg-gray-700"></div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 rounded-full bg-red-100 text-red-600 flex items-center justify-center"><i class="fa-solid fa-arrow-up"></i></div>
                                        <div><p class="text-xs text-gray-400 font-bold">–†–∞—Å—Ö–æ–¥—ã</p><p class="font-bold text-lg" id="expenseDisplay">0 ‚Ç∏</p></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-darkCard p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-800 flex flex-col items-center justify-center">
                            <h3 class="text-gray-500 dark:text-gray-400 text-xs font-bold uppercase tracking-wider mb-2 w-full text-left">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                            <div class="w-40 h-40">
                                <canvas id="financeChart"></canvas>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-darkCard p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-800 flex flex-col">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-gray-500 dark:text-gray-400 text-xs font-bold uppercase tracking-wider">–ö—Ä–µ–¥–∏—Ç—ã / –î–æ–ª–≥–∏</h3>
                                <button onclick="openModal('creditModal')" class="text-xs font-bold text-primary bg-indigo-50 dark:bg-indigo-900/30 px-3 py-1.5 rounded-lg hover:bg-indigo-100 transition">+ –î–æ–±–∞–≤–∏—Ç—å</button>
                            </div>
                            
                            <div id="creditList" class="flex-1 overflow-y-auto space-y-4 max-h-60 pr-1">
                                </div>
                            
                            <div id="noCredits" class="hidden text-center py-6 text-gray-400 text-sm">
                                –ö—Ä–µ–¥–∏—Ç–æ–≤ –Ω–µ—Ç. –í—ã —Å–≤–æ–±–æ–¥–Ω—ã!
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-darkCard p-8 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-800 fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-bold text-xl">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
                            <button onclick="clearHistory()" class="text-xs font-bold text-red-400 hover:text-red-500">–û—á–∏—Å—Ç–∏—Ç—å</button>
                        </div>
                        <div id="transactionList" class="space-y-4">
                            </div>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <div id="transactionModal" class="fixed inset-0 z-[100] hide items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeModal('transactionModal')"></div>
        <div class="bg-white dark:bg-darkCard w-full max-w-md rounded-3xl shadow-2xl relative z-10 p-6 fade-in">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</h3>
                <button onclick="closeModal('transactionModal')" class="w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-500"><i class="fa-solid fa-xmark"></i></button>
            </div>

            <form id="formTransaction" class="space-y-5">
                <div class="grid grid-cols-2 p-1 bg-gray-100 dark:bg-gray-800 rounded-xl">
                    <button type="button" onclick="setType('expense')" id="btn-expense" class="py-3 rounded-lg font-bold text-sm bg-white dark:bg-darkCard shadow-sm text-red-500 transition">–†–∞—Å—Ö–æ–¥</button>
                    <button type="button" onclick="setType('income')" id="btn-income" class="py-3 rounded-lg font-bold text-sm text-gray-500 transition">–î–æ—Ö–æ–¥</button>
                </div>

                <div>
                    <label class="block text-xs font-bold text-gray-400 mb-1 ml-1">–°—É–º–º–∞ (‚Ç∏)</label>
                    <input type="number" id="t-amount" placeholder="0" class="w-full text-3xl font-black bg-transparent border-b-2 border-gray-200 dark:border-gray-700 focus:border-primary outline-none py-2" required>
                </div>

                <input type="text" id="t-title" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" class="w-full px-4 py-4 bg-gray-50 dark:bg-gray-800 rounded-xl font-bold outline-none focus:ring-2 focus:ring-primary/20">

                <div>
                    <label class="block text-xs font-bold text-gray-400 mb-2 ml-1 uppercase">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <div class="grid grid-cols-4 gap-3" id="catGrid">
                        </div>
                </div>

                <button type="submit" class="w-full bg-primary py-4 rounded-xl text-white font-bold text-lg shadow-lg hover:bg-indigo-700 transition">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <div id="creditModal" class="fixed inset-0 z-[100] hide items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeModal('creditModal')"></div>
        <div class="bg-white dark:bg-darkCard w-full max-w-md rounded-3xl shadow-2xl relative z-10 p-6 fade-in">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold">–î–æ–±–∞–≤–∏—Ç—å –ö—Ä–µ–¥–∏—Ç/–î–æ–ª–≥</h3>
                <button onclick="closeModal('creditModal')" class="w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-500"><i class="fa-solid fa-xmark"></i></button>
            </div>

            <form id="formCredit" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-400 mb-1 ml-1">–ù–∞–∑–≤–∞–Ω–∏–µ (–ë–∞–Ω–∫ / –ò–º—è)</label>
                    <input type="text" id="c-title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Kaspi Gold" class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-800 rounded-xl font-bold outline-none border border-transparent focus:border-primary transition" required>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-400 mb-1 ml-1">–û–±—â–∞—è —Å—É–º–º–∞ –¥–æ–ª–≥–∞</label>
                        <input type="number" id="c-total" placeholder="100000" class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-800 rounded-xl font-bold outline-none border border-transparent focus:border-primary transition" required>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-400 mb-1 ml-1">–£–∂–µ –≤—ã–ø–ª–∞—á–µ–Ω–æ</label>
                        <input type="number" id="c-paid" placeholder="0" class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-800 rounded-xl font-bold outline-none border border-transparent focus:border-primary transition" value="0">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-gray-400 mb-1 ml-1">–°—Ä–æ–∫ –ø–æ–≥–∞—à–µ–Ω–∏—è</label>
                    <input type="date" id="c-date" class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-800 rounded-xl font-bold outline-none border border-transparent focus:border-primary transition text-gray-600 dark:text-gray-300">
                </div>

                <button type="submit" class="w-full bg-primary py-4 rounded-xl text-white font-bold shadow-lg hover:bg-indigo-700 transition mt-2">–î–æ–±–∞–≤–∏—Ç—å –ö—Ä–µ–¥–∏—Ç</button>
            </form>
        </div>
    </div>

    <div id="payModal" class="fixed inset-0 z-[110] hide items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeModal('payModal')"></div>
        <div class="bg-white dark:bg-darkCard w-full max-w-sm rounded-3xl shadow-2xl relative z-10 p-6 fade-in">
            <h3 class="text-lg font-bold mb-4">–í–Ω–µ—Å—Ç–∏ –ø–ª–∞—Ç–µ–∂</h3>
            <p class="text-sm text-gray-400 mb-4" id="payTargetName">–ö—Ä–µ–¥–∏—Ç</p>
            <form id="formPay" class="space-y-4">
                <input type="hidden" id="pay-id">
                <input type="number" id="pay-amount" placeholder="–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è" class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-800 rounded-xl font-bold outline-none focus:ring-2 focus:ring-primary" required>
                <button type="submit" class="w-full bg-green-500 text-white font-bold py-3 rounded-xl shadow-lg">–í–Ω–µ—Å—Ç–∏</button>
            </form>
        </div>
    </div>

    <script>
        // --- –î–ê–ù–ù–´–ï –ò –ù–ê–°–¢–†–û–ô–ö–ò ---
         const CONFIG = {
            categories: {
                expense: [
                    {id: 'food', name: '–ï–¥–∞', icon: 'fa-utensils', color: 'text-orange-500 bg-orange-100'},
                    {id: 'tr', name: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', icon: 'fa-car', color: 'text-blue-500 bg-blue-100'},
                    {id: 'shop', name: '–ü–æ–∫—É–ø–∫–∏', icon: 'fa-bag-shopping', color: 'text-purple-500 bg-purple-100'},
                    {id: 'home', name: '–î–æ–º', icon: 'fa-house', color: 'text-green-500 bg-green-100'},
                    {id: 'fun', name: '–†–∞–∑–≤–ª–µ—á.', icon: 'fa-gamepad', color: 'text-indigo-500 bg-indigo-100'},
                    {id: 'other', name: '–î—Ä—É–≥–æ–µ', icon: 'fa-ellipsis', color: 'text-gray-500 bg-gray-100'},
                ],
                income: [
                    {id: 'sal', name: '–ó–∞—Ä–ø–ª–∞—Ç–∞', icon: 'fa-briefcase', color: 'text-green-600 bg-green-100'},
                    {id: 'free', name: '–§—Ä–∏–ª–∞–Ω—Å', icon: 'fa-laptop', color: 'text-blue-600 bg-blue-100'},
                    {id: 'gift', name: '–ü–æ–¥–∞—Ä–æ–∫', icon: 'fa-gift', color: 'text-pink-600 bg-pink-100'},
                ]
            }
        };

        let DATA = {
            pin: localStorage.getItem('neoPin'),
            transactions: JSON.parse(localStorage.getItem('neoTrans')) || [],
            credits: JSON.parse(localStorage.getItem('neoCredits')) || [],
            theme: localStorage.getItem('neoTheme') || 'light'
        };

        let STATE = {
            inputPin: '',
            transType: 'expense',
            selectedCat: 0
        };

        let chartInstance = null;

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        document.addEventListener('DOMContentLoaded', () => {
            applyTheme();
            checkAuth();
        });

        // --- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ---
        function checkAuth() {
            const pinScreen = document.getElementById('pinScreen');
            const mainApp = document.getElementById('mainApp');
            const title = document.getElementById('pinTitle');
            const sub = document.getElementById('pinSubtitle');

            if (!DATA.pin) {
                title.innerText = "–°–æ–∑–¥–∞–Ω–∏–µ PIN";
                sub.innerText = "–ü—Ä–∏–¥—É–º–∞–π—Ç–µ 4 —Ü–∏—Ñ—Ä—ã";
            } else {
                title.innerText = "–í—Ö–æ–¥";
                sub.innerText = "–í–≤–µ–¥–∏—Ç–µ PIN";
            }
        }

        function inputPin(val) {
            const dots = document.querySelectorAll('.dot');
            
            if (val === 'del') {
                STATE.inputPin = STATE.inputPin.slice(0, -1);
            } else {
                if (STATE.inputPin.length < 4) STATE.inputPin += val;
            }

            // –†–µ–Ω–¥–µ—Ä —Ç–æ—á–µ–∫
            dots.forEach((dot, idx) => {
                if (idx < STATE.inputPin.length) {
                    dot.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                    dot.classList.add('bg-primary', 'scale-125');
                } else {
                    dot.classList.add('bg-gray-200', 'dark:bg-gray-700');
                    dot.classList.remove('bg-primary', 'scale-125');
                }
            });

            // –ü—Ä–æ–≤–µ—Ä–∫–∞
            if (STATE.inputPin.length === 4) {
                setTimeout(validatePin, 100);
            }
        }

        function validatePin() {
            const pinScreen = document.getElementById('pinScreen');
            
            if (!DATA.pin) {
                // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ
                DATA.pin = STATE.inputPin;
                localStorage.setItem('neoPin', DATA.pin);
                unlock();
            } else {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ
                if (STATE.inputPin === DATA.pin) {
                    unlock();
                } else {
                    // –û—à–∏–±–∫–∞
                    pinScreen.classList.add('shake');
                    setTimeout(() => {
                        pinScreen.classList.remove('shake');
                        STATE.inputPin = '';
                        inputPin('del'); // –°–±—Ä–æ—Å UI
                        inputPin('del');
                        inputPin('del');
                        inputPin('del');
                    }, 400);
                }
            }
        }

        function unlock() {
            document.getElementById('pinScreen').classList.add('hide');
            const app = document.getElementById('mainApp');
            app.classList.remove('hide');
            // Timeout –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
            setTimeout(() => app.classList.remove('opacity-0'), 50);
            
            initApp();
        }

        function resetAllData() {
            if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏ PIN-–∫–æ–¥? –≠—Ç–æ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.')) {
                localStorage.clear();
                location.reload();
            }
        }

        // --- –õ–û–ì–ò–ö–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ---
        function initApp() {
            updateDashboard();
            renderCategoryGrid();
        }

        function updateDashboard() {
            // 1. –°—á–∏—Ç–∞–µ–º –±–∞–ª–∞–Ω—Å
            let inc = 0, exp = 0;
            DATA.transactions.forEach(t => {
                if (t.type === 'income') inc += t.amount;
                else exp += t.amount;
            });

            // 2. –û–±–Ω–æ–≤–ª—è–µ–º HTML
            animateValue('totalBalance', inc - exp);
            document.getElementById('incomeDisplay').innerText = formatMoney(inc);
            document.getElementById('expenseDisplay').innerText = formatMoney(exp);

            // 3. –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–æ–≤
            renderTransactions();
            renderCredits();
            renderChart(inc, exp);

            // 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            saveData();
        }

        function formatMoney(num) {
            return new Intl.NumberFormat('kk-KZ').format(num) + ' ‚Ç∏';
        }

        function animateValue(id, end) {
            const el = document.getElementById(id);
            // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è: –ø—Ä–æ—Å—Ç–æ —Å—Ç–∞–≤–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–µ –º–µ–ª—å–∫–∞–ª–æ
            el.innerText = formatMoney(end);
        }

        // --- –¢–†–ê–ù–ó–ê–ö–¶–ò–ò ---
        function renderTransactions() {
            const list = document.getElementById('transactionList');
            list.innerHTML = '';
            
            if (DATA.transactions.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-400 py-4">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>';
                return;
            }

            [...DATA.transactions].reverse().forEach(t => {
                const isInc = t.type === 'income';
                const el = document.createElement('div');
                el.className = "flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-2xl";
                el.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full ${t.catColor} flex items-center justify-center">
                            <i class="fa-solid ${t.catIcon}"></i>
                        </div>
                        <div>
                            <p class="font-bold text-sm">${t.title || t.catName}</p>
                            <p class="text-xs text-gray-400">${new Date(t.date).toLocaleDateString()}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="font-bold ${isInc ? 'text-green-500' : 'text-gray-900 dark:text-white'}">
                            ${isInc ? '+' : '-'} ${formatMoney(t.amount)}
                        </span>
                        <button onclick="delTrans(${t.id})" class="text-gray-300 hover:text-red-500"><i class="fa-solid fa-trash"></i></button>
                    </div>
                `;
                list.appendChild(el);
            });
        }

        // --- –ö–†–ï–î–ò–¢–´ (–õ–û–ì–ò–ö–ê) ---
        function renderCredits() {
            const list = document.getElementById('creditList');
            const noData = document.getElementById('noCredits');
            list.innerHTML = '';

            if (DATA.credits.length === 0) {
                noData.classList.remove('hidden');
                return;
            }
            noData.classList.add('hidden');

            DATA.credits.forEach(c => {
                // –†–∞—Å—á–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞
                let percent = Math.min(100, Math.round((c.paid / c.total) * 100));
                let remain = c.total - c.paid;
                
                // –†–∞—Å—á–µ—Ç –¥–Ω–µ–π (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞—Ç–∞)
                let dateStr = '';
                if(c.date) {
                    const diff = new Date(c.date) - new Date();
                    const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
                    dateStr = days > 0 ? `${days} –¥–Ω. –æ—Å—Ç–∞–ª–æ—Å—å` : '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ';
                }

                const el = document.createElement('div');
                el.className = "bg-gray-50 dark:bg-gray-800 p-4 rounded-2xl border border-gray-100 dark:border-gray-700 relative overflow-hidden";
                
                el.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h4 class="font-bold text-sm">${c.title}</h4>
                            <p class="text-xs text-gray-400 font-mono">${dateStr}</p>
                        </div>
                        <button onclick="delCredit(${c.id})" class="text-gray-300 hover:text-red-500 text-xs"><i class="fa-solid fa-times"></i></button>
                    </div>
                    
                    <div class="flex justify-between text-xs font-bold mb-1">
                        <span class="text-green-500">${formatMoney(c.paid)}</span>
                        <span class="text-gray-500">${formatMoney(c.total)}</span>
                    </div>
                    
                    <div class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full mb-3 overflow-hidden">
                        <div class="h-full bg-primary transition-all duration-500" style="width: ${percent}%"></div>
                    </div>
                    
                    ${remain > 0 ? 
                        `<button onclick="openPayModal(${c.id}, '${c.title}')" class="w-full py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-xs font-bold hover:bg-gray-100 dark:hover:bg-gray-600 transition">–í–Ω–µ—Å—Ç–∏ –ø–ª–∞—Ç–µ–∂</button>` : 
                        `<div class="text-center text-xs font-bold text-green-500 uppercase tracking-widest bg-green-100 dark:bg-green-900/30 py-1 rounded">–í—ã–ø–ª–∞—á–µ–Ω–æ!</div>`
                    }
                `;
                list.appendChild(el);
            });
        }

        // --- –ú–û–î–ê–õ–ö–ò (–£–ü–†–ê–í–õ–ï–ù–ò–ï) ---
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º classList.remove('hide') –∏ .add('flex') –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
        function openModal(id) {
            const modal = document.getElementById(id);
            modal.classList.remove('hide');
            modal.classList.add('flex'); // Tailwind flex class
        }

        function closeModal(id) {
            const modal = document.getElementById(id);
            modal.classList.add('hide');
            modal.classList.remove('flex');
        }

        function openPayModal(id, title) {
            document.getElementById('pay-id').value = id;
            document.getElementById('payTargetName').innerText = title;
            openModal('payModal');
        }

        // --- –§–û–†–ú–´ (HANDLERS) ---
        
        // 1. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
        document.getElementById('formTransaction').onsubmit = (e) => {
            e.preventDefault();
            const amount = parseFloat(document.getElementById('t-amount').value);
            const title = document.getElementById('t-title').value;
            
            // –ù–∞—Ö–æ–¥–∏–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            const cats = CONFIG.categories[STATE.transType];
            const cat = cats[STATE.selectedCat] || cats[0];

            if (!amount) return;

            DATA.transactions.push({
                id: Date.now(),
                type: STATE.transType,
                amount,
                title,
                catName: cat.name,
                catIcon: cat.icon,
                catColor: cat.color,
                date: new Date().toISOString()
            });

            closeModal('transactionModal');
            e.target.reset();
            updateDashboard();
        };

        // 2. –ö—Ä–µ–¥–∏—Ç (–°–æ–∑–¥–∞–Ω–∏–µ)
        document.getElementById('formCredit').onsubmit = (e) => {
            e.preventDefault();
            const title = document.getElementById('c-title').value;
            const total = parseFloat(document.getElementById('c-total').value);
            const paid = parseFloat(document.getElementById('c-paid').value) || 0;
            const date = document.getElementById('c-date').value;

            if (!title || !total) return;

            DATA.credits.push({
                id: Date.now(),
                title,
                total,
                paid,
                date
            });

            closeModal('creditModal');
            e.target.reset();
            updateDashboard();
        };

        // 3. –ü–ª–∞—Ç–µ–∂ –ø–æ –∫—Ä–µ–¥–∏—Ç—É
        document.getElementById('formPay').onsubmit = (e) => {
            e.preventDefault();
            const id = parseInt(document.getElementById('pay-id').value);
            const amount = parseFloat(document.getElementById('pay-amount').value);

            if (!amount) return;

            // –ù–∞—Ö–æ–¥–∏–º –∫—Ä–µ–¥–∏—Ç
            const credit = DATA.credits.find(c => c.id === id);
            if (credit) {
                credit.paid += amount;
                
                // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ—Ç –ø–ª–∞—Ç–µ–∂ –∫–∞–∫ "–†–∞—Å—Ö–æ–¥" –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏?
                // –î–∞–≤–∞–π –¥–æ–±–∞–≤–∏–º, —á—Ç–æ–±—ã –±–∞–ª–∞–Ω—Å —É–º–µ–Ω—å—à–∏–ª—Å—è
                DATA.transactions.push({
                    id: Date.now(),
                    type: 'expense',
                    amount: amount,
                    title: `–û–ø–ª–∞—Ç–∞ –∫—Ä–µ–¥–∏—Ç–∞: ${credit.title}`,
                    catName: '–ö—Ä–µ–¥–∏—Ç',
                    catIcon: 'fa-file-invoice-dollar',
                    catColor: 'text-indigo-500 bg-indigo-100',
                    date: new Date().toISOString()
                });
            }

            closeModal('payModal');
            e.target.reset();
            updateDashboard();
        };

        // --- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ---
        function setType(type) {
            STATE.transType = type;
            const btnExp = document.getElementById('btn-expense');
            const btnInc = document.getElementById('btn-income');

            if (type === 'expense') {
                btnExp.className = "py-3 rounded-lg font-bold text-sm bg-white dark:bg-darkCard shadow-sm text-red-500 transition";
                btnInc.className = "py-3 rounded-lg font-bold text-sm text-gray-500 transition";
            } else {
                btnInc.className = "py-3 rounded-lg font-bold text-sm bg-white dark:bg-darkCard shadow-sm text-green-500 transition";
                btnExp.className = "py-3 rounded-lg font-bold text-sm text-gray-500 transition";
            }
            renderCategoryGrid();
        }

        function renderCategoryGrid() {
            const grid = document.getElementById('catGrid');
            grid.innerHTML = '';
            const list = CONFIG.categories[STATE.transType];
            
            list.forEach((cat, idx) => {
                const isActive = idx === STATE.selectedCat;
                const el = document.createElement('div');
                el.className = `flex flex-col items-center p-2 rounded-xl cursor-pointer transition ${isActive ? 'bg-indigo-50 dark:bg-indigo-900/30 ring-2 ring-primary' : 'hover:bg-gray-100 dark:hover:bg-gray-800'}`;
                el.onclick = () => { STATE.selectedCat = idx; renderCategoryGrid(); };
                el.innerHTML = `
                    <div class="w-8 h-8 rounded-full flex items-center justify-center mb-1 ${cat.color}">
                        <i class="fa-solid ${cat.icon} text-xs"></i>
                    </div>
                    <span class="text-[10px] font-bold uppercase text-gray-500">${cat.name}</span>
                `;
                grid.appendChild(el);
            });
        }

        function delTrans(id) {
            if(confirm('–£–¥–∞–ª–∏—Ç—å?')) {
                DATA.transactions = DATA.transactions.filter(t => t.id !== id);
                updateDashboard();
            }
        }
        
        function delCredit(id) {
            if(confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫—Ä–µ–¥–∏—Ç –∏–∑ —Å–ø–∏—Å–∫–∞?')) {
                DATA.credits = DATA.credits.filter(c => c.id !== id);
                updateDashboard();
            }
        }

        function clearHistory() {
            if(confirm('–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π? (–ö—Ä–µ–¥–∏—Ç—ã –æ—Å—Ç–∞–Ω—É—Ç—Å—è)')) {
                DATA.transactions = [];
                updateDashboard();
            }
        }

        function saveData() {
            localStorage.setItem('neoTrans', JSON.stringify(DATA.transactions));
            localStorage.setItem('neoCredits', JSON.stringify(DATA.credits));
        }

        // --- –ì–†–ê–§–ò–ö ---
        function renderChart(inc, exp) {
            const ctx = document.getElementById('financeChart').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['–î–æ—Ö–æ–¥', '–†–∞—Å—Ö–æ–¥'],
                    datasets: [{
                        data: [inc || 1, exp],
                        backgroundColor: ['#10b981', '#6366f1'],
                        borderWidth: 0,
                        hoverOffset: 5
                    }]
                },
                options: {
                    cutout: '85%',
                    plugins: { legend: { display: false } },
                    animation: { animateScale: true }
                }
            });
        }

        // --- –¢–ï–ú–ê ---
        function toggleTheme() {
            DATA.theme = DATA.theme === 'light' ? 'dark' : 'light';
            localStorage.setItem('neoTheme', DATA.theme);
            applyTheme();
        }

        function applyTheme() {
            const html = document.documentElement;
            if (DATA.theme === 'dark') {
                html.classList.add('dark');
                document.getElementById('themeLabel').innerText = "–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞";
            } else {
                html.classList.remove('dark');
                document.getElementById('themeLabel').innerText = "–¢–µ–º–Ω–∞—è —Ç–µ–º–∞";
            }
        }

    </script>
</body>
</html>
 
